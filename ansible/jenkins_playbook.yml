---

- name: Jenkins Playbook
  gather_facts: false
  hosts: all
  become: yes
  tasks:
    - name: "apt-key"
      shell:
        cmd: "wget -q -O - https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo apt-key add -"

    - name: "append repo"
      shell:
        cmd: "sudo sh -c 'echo deb http://pkg.jenkins.io/debian-stable binary/ > /etc/apt/sources.list.d/jenkins.list'"

    - name: "apt-get update"
      apt:
        update_cache: yes
        cache_valid_time: 3600

    - name: "install java"
      apt:
        name: ['default-jre']
        state: latest

    - name: "install jenkins"
      apt:
        name: ['jenkins']
        state: latest

    - name: "start jenkins"
      systemd:
        state: started
        name: jenkins

    - name: "install azure-cli pre-req"
      apt:
        name: ['ca-certificates', 'curl', 'apt-transport-https', 'lsb-release', 'gnupg']
        state: latest

    - name: "Download and install the Microsoft signing key"
      shell:
        cmd: "curl -sL https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor | sudo tee /etc/apt/trusted.gpg.d/microsoft.gpg > /dev/null"

    - name: "Add the Azure CLI software repository"
      shell:
        cmd: "AZ_REPO=$(lsb_release -cs) && echo 'deb [arch=amd64] https://packages.microsoft.com/repos/azure-cli/ $AZ_REPO main' | sudo tee /etc/apt/sources.list.d/azure-cli.list "

    - name: "apt-get update"
      apt:
        update_cache: yes
        cache_valid_time: 3600

    - name: "Install the azure-cli package"
      apt:
        name: ['azure-cli']
        state: latest